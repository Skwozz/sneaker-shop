<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>SneakerShop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <!-- –®–∞–ø–∫–∞ -->
  <header class="header">
    <div class="container header-inner">
      <a href="/home" class="logo">SneakerShop</a>
      <nav class="nav">

        {% if current_user %}
        <a href="/cart/">üõí</a>
        <a href="/orders/">–ó–∞–∫–∞–∑—ã</a>
        <a href="/logout">–í—ã–π—Ç–∏</a>
        {% else %}
        <a href="/login">–í–æ–π—Ç–∏</a>
        {% endif %}

      </nav>
    </div>
  </header>

 <main class="container cart-layout">

  <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: —Ç–æ–≤–∞—Ä—ã -->
  <div class="cart-items">
    <div class="product-grid">
      {% for item in items %}
      {% set size_info = item.variant.sizes | selectattr('size', 'equalto', item.size) | list | first %}
      <div class="product-card">
        <img src="{{ item.variant.image_url }}" alt="{{ item.variant.product.name }}">

        <div class="product-info">
          <h3>{{ item.variant.product.name }}</h3>
          <p>{{ item.variant.product.brand }} / –†–∞–∑–º–µ—Ä {{ item.size }}</p>

          {% if size_info %}
            <p>–û—Å—Ç–∞—Ç–æ–∫: {{ size_info.quantity }}</p>
          {% else %}
            <p style="color: red;">–†–∞–∑–º–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω</p>
          {% endif %}

          <div class="price-cart">
            <span class="price">{{ item.variant.price }}$</span>

            <form method="post" action="/cart/update-quantity/">
              <input type="hidden" name="item_id" value="{{ item.id }}">
              <input type="number" name="quantity"
                     value="{{ item.quantity }}"
                     min="1"
                     max="{{ size_info.quantity if size_info else 1 }}"
                     style="width: 60px;">
              <button type="submit">–û–±–Ω–æ–≤–∏—Ç—å</button>
            </form>

            <form method="post" action="/delete-cart-item/">
              <input type="hidden" name="item_id" value="{{ item.id }}">
              <button type="submit">–£–¥–∞–ª–∏—Ç—å</button>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ -->
  <div class="cart-summary">
    <div class="total-box">
      <h3>üí∞ –û–±—â–∞—è —Å—É–º–º–∞ –∫–æ—Ä–∑–∏–Ω—ã: {{ total }} $</h3>
    </div>
    {% if total > 0 %}
    <form method="post" action="/orders/create/">
      <button type="submit" class="checkout-btn">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </form>
    {% endif %}
  </div>

</main>
